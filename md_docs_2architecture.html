<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>POSIX Shared Memory Data Structures: Architecture Deep Dive</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">POSIX Shared Memory Data Structures<span id="projectnumber">&#160;1.0</span>
   </div>
   <div id="projectbrief">High-performance lock-free data structures for inter-process communication</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md_docs_2architecture.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Architecture Deep Dive</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md103"></a> </p>
<h1><a class="anchor" id="autotoc_md104"></a>
System Architecture Overview</h1>
<div class="fragment"><div class="line">┌──────────────────────────────────────────────────────────┐</div>
<div class="line">│                     Application Layer                      │</div>
<div class="line">│  ┌─────────────┐  ┌──────────────┐  ┌──────────────┐    │</div>
<div class="line">│  │ Simulation  │  │   Renderer   │  │   Analytics  │    │</div>
<div class="line">│  └─────────────┘  └──────────────┘  └──────────────┘    │</div>
<div class="line">└───────────────────────┬──────────────────────────────────┘</div>
<div class="line">                        │</div>
<div class="line">┌───────────────────────▼──────────────────────────────────┐</div>
<div class="line">│                Data Structure Layer                       │</div>
<div class="line">│  ┌────────┐ ┌────────┐ ┌──────┐ ┌──────┐ ┌────────┐   │</div>
<div class="line">│  │ Array  │ │ Queue  │ │ Pool │ │ Ring │ │ Atomic │   │</div>
<div class="line">│  └────────┘ └────────┘ └──────┘ └──────┘ └────────┘   │</div>
<div class="line">└───────────────────────┬──────────────────────────────────┘</div>
<div class="line">                        │</div>
<div class="line">┌───────────────────────▼──────────────────────────────────┐</div>
<div class="line">│                  Foundation Layer                         │</div>
<div class="line">│  ┌──────────┐  ┌──────────┐  ┌──────────┐              │</div>
<div class="line">│  │ posix_shm│  │ shm_table│  │ shm_span │              │</div>
<div class="line">│  └──────────┘  └──────────┘  └──────────┘              │</div>
<div class="line">└───────────────────────┬──────────────────────────────────┘</div>
<div class="line">                        │</div>
<div class="line">┌───────────────────────▼──────────────────────────────────┐</div>
<div class="line">│                    POSIX API Layer                        │</div>
<div class="line">│         shm_open, mmap, shm_unlink, futex                │</div>
<div class="line">└───────────────────────┬──────────────────────────────────┘</div>
<div class="line">                        │</div>
<div class="line">┌───────────────────────▼──────────────────────────────────┐</div>
<div class="line">│                    Kernel Space                           │</div>
<div class="line">│          Virtual Memory, Page Tables, IPC                │</div>
<div class="line">└──────────────────────────────────────────────────────────┘</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md105"></a>
Memory Layout</h1>
<h2><a class="anchor" id="autotoc_md106"></a>
Shared Memory Segment Structure</h2>
<div class="fragment"><div class="line">Offset   Size     Component</div>
<div class="line">──────────────────────────────────────────</div>
<div class="line">0x0000   4        Reference Counter (atomic)</div>
<div class="line">0x0004   4-424KB  Metadata Table (configurable)</div>
<div class="line">0xXXXX   Variable Data Structure 1</div>
<div class="line">0xYYYY   Variable Data Structure 2</div>
<div class="line">...</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md107"></a>
Metadata Table Entry</h2>
<div class="fragment"><div class="line"><span class="keyword">struct </span>entry {</div>
<div class="line">    <span class="keywordtype">char</span> name[MAX_NAME_SIZE];  <span class="comment">// Unique identifier</span></div>
<div class="line">    <span class="keywordtype">size_t</span> offset;              <span class="comment">// Byte offset in segment</span></div>
<div class="line">    <span class="keywordtype">size_t</span> size;                <span class="comment">// Total size in bytes</span></div>
<div class="line">    <span class="keywordtype">size_t</span> elem_size;           <span class="comment">// Element size (for arrays)</span></div>
<div class="line">    <span class="keywordtype">size_t</span> num_elem;            <span class="comment">// Number of elements</span></div>
<div class="line">    <span class="keywordtype">bool</span> active;                <span class="comment">// Entry valid flag</span></div>
<div class="line">};</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md108"></a>
Component Design</h1>
<h2><a class="anchor" id="autotoc_md109"></a>
1. posix_shm - Memory Management</h2>
<p><b>Responsibilities:</b></p><ul>
<li>POSIX shared memory lifecycle</li>
<li>Reference counting</li>
<li>Memory mapping</li>
<li>Automatic cleanup</li>
</ul>
<p><b>Key Design Decisions:</b></p>
<ol type="1">
<li><b>RAII Pattern</b>: Automatic cleanup in destructor</li>
<li><b>Reference Counting</b>: Last process cleans up</li>
<li><b>Header Embedding</b>: Table stored in shared memory</li>
<li><b>Template Configuration</b>: Compile-time table sizing</li>
</ol>
<div class="fragment"><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> TableType&gt;</div>
<div class="line"><span class="keyword">class </span><a class="code hl_class" href="classposix__shm__impl.html">posix_shm_impl</a> {</div>
<div class="line">    <span class="keyword">struct </span>header {</div>
<div class="line">        std::atomic&lt;int&gt; ref_count;</div>
<div class="line">        TableType table;  <span class="comment">// Embedded metadata</span></div>
<div class="line">    };</div>
<div class="line">};</div>
<div class="ttc" id="aclassposix__shm__impl_html"><div class="ttname"><a href="classposix__shm__impl.html">posix_shm_impl</a></div><div class="ttdoc">POSIX shared memory wrapper with RAII and reference counting.</div><div class="ttdef"><b>Definition</b> <a href="posix__shm_8h_source.html#l00061">posix_shm.h:62</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md110"></a>
2. shm_table - Discovery System</h2>
<p><b>Responsibilities:</b></p><ul>
<li>Name-to-offset mapping</li>
<li>Dynamic structure discovery</li>
<li>Allocation tracking</li>
<li>Metadata storage</li>
</ul>
<p><b>Design Pattern: Service Locator</b></p>
<div class="fragment"><div class="line"><span class="comment">// Register service</span></div>
<div class="line">table-&gt;add(<span class="stringliteral">&quot;sensor_data&quot;</span>, offset, size);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Discover service</span></div>
<div class="line"><span class="keyword">auto</span>* entry = table-&gt;find(<span class="stringliteral">&quot;sensor_data&quot;</span>);</div>
</div><!-- fragment --><p><b>Trade-offs:</b></p><ul>
<li>Fixed maximum entries (compile-time)</li>
<li>Linear search (simple, cache-friendly)</li>
<li>No defragmentation (predictable performance)</li>
</ul>
<p><b>Memory Management: Stack/Bump Allocation</b></p>
<p>Our current implementation uses <b>stack allocation</b> (also called bump allocation): </p><div class="fragment"><div class="line"><span class="comment">// Allocation strategy (simplified)</span></div>
<div class="line"><span class="keywordtype">size_t</span> allocate(<span class="keywordtype">size_t</span> size) {</div>
<div class="line">    <span class="keywordtype">size_t</span> offset = <span class="keyword">sizeof</span>(table) + get_total_allocated_size();</div>
<div class="line">    total_allocated += size;</div>
<div class="line">    <span class="keywordflow">return</span> offset;</div>
<div class="line">}</div>
</div><!-- fragment --><p>This means:</p><ul>
<li>✅ <b>Simple</b>: O(1) allocation, no scanning</li>
<li>✅ <b>Predictable</b>: No fragmentation delays</li>
<li>❌ <b>No reclamation</b>: Erased structures leave permanent gaps</li>
<li>❌ <b>Memory leak</b>: Repeated create/delete exhausts memory</li>
</ul>
<p><b>Best Practices:</b></p><ol type="1">
<li><b>Initialize once</b>: Create all structures at startup</li>
<li><b>Never erase</b>: Treat structures as permanent</li>
<li><b>Use pools</b>: For dynamic needs, use <code><a class="el" href="classshm__object__pool.html" title="High-performance object pool for shared memory.">shm_object_pool</a></code></li>
<li><b>Size appropriately</b>: Allocate enough memory upfront</li>
</ol>
<p><b>Future Improvement:</b> A free-list allocator could reuse gaps, but adds complexity and potential fragmentation issues.</p>
<h2><a class="anchor" id="autotoc_md111"></a>
3. Data Structure Implementations</h2>
<h3><a class="anchor" id="autotoc_md112"></a>
shm_array&lt;T&gt; - Contiguous Storage</h3>
<p><b>Memory Layout:</b> </p><div class="fragment"><div class="line">[T][T][T][T][T][T][T][T]...</div>
</div><!-- fragment --><p><b>Operations:</b></p><ul>
<li><code>operator[]</code>: Direct pointer arithmetic</li>
<li>Iterators: Raw pointers</li>
<li>No dynamic growth (fixed size)</li>
</ul>
<h3><a class="anchor" id="autotoc_md113"></a>
shm_queue&lt;T&gt; - Lock-Free FIFO</h3>
<p><b>Memory Layout:</b> </p><div class="fragment"><div class="line">[Header]</div>
<div class="line">  atomic&lt;size_t&gt; head</div>
<div class="line">  atomic&lt;size_t&gt; tail</div>
<div class="line">  size_t capacity</div>
<div class="line">[T][T][T][T]... (circular buffer)</div>
</div><!-- fragment --><p><b>Algorithm: Lock-Free Enqueue</b> </p><div class="fragment"><div class="line"><span class="keywordtype">bool</span> enqueue(T value) {</div>
<div class="line">    <span class="keywordtype">size_t</span> tail = tail_.load(acquire);</div>
<div class="line">    <span class="keywordtype">size_t</span> next = (tail + 1) % capacity;</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">if</span> (next == head_.load(acquire))</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>;  <span class="comment">// Full</span></div>
<div class="line">        </div>
<div class="line">    buffer[tail] = value;</div>
<div class="line">    tail_.store(next, release);</div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md114"></a>
shm_object_pool&lt;T&gt; - Free List</h3>
<p><b>Memory Layout:</b> </p><div class="fragment"><div class="line">[Header]</div>
<div class="line">  atomic&lt;uint32_t&gt; free_head</div>
<div class="line">  uint32_t next[capacity]</div>
<div class="line">[T][T][T][T]... (object storage)</div>
</div><!-- fragment --><p><b>Algorithm: Lock-Free Stack</b> </p><div class="fragment"><div class="line">uint32_t acquire() {</div>
<div class="line">    uint32_t old_head = free_head.load();</div>
<div class="line">    <span class="keywordflow">while</span> (old_head != NULL) {</div>
<div class="line">        uint32_t new_head = next[old_head];</div>
<div class="line">        <span class="keywordflow">if</span> (CAS(&amp;free_head, old_head, new_head))</div>
<div class="line">            <span class="keywordflow">return</span> old_head;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> NULL;</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md115"></a>
shm_ring_buffer&lt;T&gt; - Bulk Operations</h3>
<p><b>Design Goals:</b></p><ul>
<li>Optimize for throughput over latency</li>
<li>Support non-consuming reads</li>
<li>Allow overwrite mode for streaming</li>
</ul>
<p><b>Key Features:</b> </p><div class="fragment"><div class="line"><span class="comment">// Bulk operations for efficiency</span></div>
<div class="line"><span class="keywordtype">size_t</span> push_bulk(span&lt;T&gt; values);</div>
<div class="line"><span class="keywordtype">size_t</span> pop_bulk(span&lt;T&gt; output);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Streaming mode</span></div>
<div class="line"><span class="keywordtype">void</span> push_overwrite(T value);  <span class="comment">// Drops oldest</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Analytics</span></div>
<div class="line">uint64_t total_written();  <span class="comment">// Monitor throughput</span></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md116"></a>
Synchronization Strategies</h1>
<h2><a class="anchor" id="autotoc_md117"></a>
1. Lock-Free Algorithms</h2>
<p><b>Used In:</b> Queue, Pool, Ring Buffer</p>
<p><b>Techniques:</b></p><ul>
<li>Compare-And-Swap (CAS)</li>
<li>Fetch-And-Add (FAA)</li>
<li>Memory ordering (acquire-release)</li>
</ul>
<p><b>Benefits:</b></p><ul>
<li>No kernel involvement</li>
<li>Bounded latency</li>
<li>Progress guarantee</li>
</ul>
<h2><a class="anchor" id="autotoc_md118"></a>
2. Wait-Free Readers</h2>
<p><b>Used In:</b> Array, Atomic</p>
<p><b>Guarantee:</b> Readers never block</p>
<div class="fragment"><div class="line">T read(<span class="keywordtype">size_t</span> index) {</div>
<div class="line">    <span class="keywordflow">return</span> data[index];  <span class="comment">// Always wait-free</span></div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md119"></a>
3. Memory Ordering</h2>
<div class="fragment"><div class="line"><span class="comment">// Writer</span></div>
<div class="line">data[index] = value;</div>
<div class="line">flag.store(<span class="keyword">true</span>, memory_order_release);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Reader  </span></div>
<div class="line"><span class="keywordflow">if</span> (flag.load(memory_order_acquire)) {</div>
<div class="line">    <span class="keyword">auto</span> value = data[index];  <span class="comment">// Synchronized</span></div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md120"></a>
Template Metaprogramming</h1>
<h2><a class="anchor" id="autotoc_md121"></a>
Compile-Time Configuration</h2>
<div class="fragment"><div class="line"><span class="keyword">template</span>&lt;<span class="keywordtype">size_t</span> MaxNameSize, <span class="keywordtype">size_t</span> MaxEntries&gt;</div>
<div class="line"><span class="keyword">class </span><a class="code hl_class" href="classshm__table__impl.html">shm_table_impl</a> {</div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">constexpr</span> <span class="keywordtype">size_t</span> <a class="code hl_function" href="classshm__table__impl.html#abbf2c1883127a65781cc2e47e7f34cef">size_bytes</a>() {</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">sizeof</span>(entry) * MaxEntries + <span class="keyword">sizeof</span>(<span class="keywordtype">size_t</span>);</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="ttc" id="aclassshm__table__impl_html"><div class="ttname"><a href="classshm__table__impl.html">shm_table_impl</a></div><div class="ttdoc">Metadata table for managing shared memory data structures.</div><div class="ttdef"><b>Definition</b> <a href="shm__table_8h_source.html#l00020">shm_table.h:21</a></div></div>
<div class="ttc" id="aclassshm__table__impl_html_abbf2c1883127a65781cc2e47e7f34cef"><div class="ttname"><a href="classshm__table__impl.html#abbf2c1883127a65781cc2e47e7f34cef">shm_table_impl::size_bytes</a></div><div class="ttdeci">static constexpr size_t size_bytes()</div><div class="ttdoc">Get the actual size of this table in bytes.</div><div class="ttdef"><b>Definition</b> <a href="shm__table_8h_source.html#l00197">shm_table.h:197</a></div></div>
</div><!-- fragment --><p><b>Benefits:</b></p><ul>
<li>Zero runtime overhead</li>
<li>Custom memory footprints</li>
<li>Type safety</li>
</ul>
<h2><a class="anchor" id="autotoc_md122"></a>
Concept Constraints</h2>
<div class="fragment"><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</div>
<div class="line">    <span class="keyword">requires</span> std::is_trivially_copyable_v&lt;T&gt;</div>
<div class="line"><span class="keyword">class </span><a class="code hl_class" href="classshm__array.html">shm_array</a> {</div>
<div class="line">    <span class="comment">// Ensures T can be safely shared</span></div>
<div class="line">};</div>
<div class="ttc" id="aclassshm__array_html"><div class="ttname"><a href="classshm__array.html">shm_array</a></div><div class="ttdoc">Fixed-size array in shared memory with zero-overhead access.</div><div class="ttdef"><b>Definition</b> <a href="shm__array_8h_source.html#l00062">shm_array.h:63</a></div></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md123"></a>
Performance Optimizations</h1>
<h2><a class="anchor" id="autotoc_md124"></a>
1. Cache Line Alignment</h2>
<div class="fragment"><div class="line"><span class="keyword">struct </span><span class="keyword">alignas</span>(64) CacheLine {</div>
<div class="line">    std::atomic&lt;uint64_t&gt; value;</div>
<div class="line">    <span class="keywordtype">char</span> padding[56];</div>
<div class="line">};</div>
</div><!-- fragment --><p><b>Prevents:</b> False sharing between cores</p>
<h2><a class="anchor" id="autotoc_md125"></a>
2. Memory Prefetching</h2>
<div class="fragment"><div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; n; i++) {</div>
<div class="line">    __builtin_prefetch(&amp;data[i + 8], 0, 1);</div>
<div class="line">    process(data[i]);</div>
<div class="line">}</div>
</div><!-- fragment --><p><b>Benefit:</b> Hides memory latency</p>
<h2><a class="anchor" id="autotoc_md126"></a>
3. Bulk Operations</h2>
<div class="fragment"><div class="line"><span class="comment">// Bad: Multiple system calls</span></div>
<div class="line"><span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; item : items)</div>
<div class="line">    queue.push(item);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Good: Single operation</span></div>
<div class="line">queue.push_bulk(items);</div>
</div><!-- fragment --><p><b>Benefit:</b> Amortizes overhead</p>
<h2><a class="anchor" id="autotoc_md127"></a>
4. Branch-Free Code</h2>
<div class="fragment"><div class="line"><span class="comment">// Branch-free min</span></div>
<div class="line"><span class="keywordtype">size_t</span> min = a ^ ((a ^ b) &amp; -(a &gt; b));</div>
</div><!-- fragment --><p><b>Benefit:</b> No pipeline stalls</p>
<h1><a class="anchor" id="autotoc_md128"></a>
Error Handling Philosophy</h1>
<h2><a class="anchor" id="autotoc_md129"></a>
1. Constructor Failures</h2>
<div class="fragment"><div class="line"><a class="code hl_class" href="classshm__array.html">shm_array</a>(shm, name, size) {</div>
<div class="line">    <span class="keywordflow">if</span> (!initialize())</div>
<div class="line">        <span class="keywordflow">throw</span> std::runtime_error(<span class="stringliteral">&quot;...&quot;</span>);</div>
<div class="line">}</div>
</div><!-- fragment --><p><b>Rationale:</b> RAII requires successful construction</p>
<h2><a class="anchor" id="autotoc_md130"></a>
2. Operation Failures</h2>
<div class="fragment"><div class="line">[[nodiscard]] <span class="keywordtype">bool</span> enqueue(T value);</div>
<div class="line">[[nodiscard]] std::optional&lt;T&gt; dequeue();</div>
</div><!-- fragment --><p><b>Rationale:</b> Let caller decide on failure handling</p>
<h2><a class="anchor" id="autotoc_md131"></a>
3. Resource Exhaustion</h2>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (pool.full())</div>
<div class="line">    <span class="keywordflow">return</span> invalid_handle;  <span class="comment">// Graceful degradation</span></div>
</div><!-- fragment --><p><b>Rationale:</b> System continues with reduced capacity</p>
<h1><a class="anchor" id="autotoc_md132"></a>
Scalability Considerations</h1>
<h2><a class="anchor" id="autotoc_md133"></a>
Process Scaling</h2>
<p><b>Strategy:</b> Read-heavy optimization</p>
<div class="fragment"><div class="line"><span class="comment">// Multiple readers, single writer pattern</span></div>
<div class="line"><span class="keyword">class </span>MRSW_Array {</div>
<div class="line">    T* data;  <span class="comment">// No synchronization for reads</span></div>
<div class="line">    std::atomic&lt;uint64_t&gt; version;  <span class="comment">// Version for consistency</span></div>
<div class="line">};</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md134"></a>
Memory Scaling</h2>
<p><b>Strategy:</b> Hierarchical structures</p>
<div class="fragment"><div class="line"><span class="comment">// Two-level structure for large datasets</span></div>
<div class="line"><span class="keyword">class </span>LargeMap {</div>
<div class="line">    <a class="code hl_class" href="classshm__array.html">shm_array&lt;Bucket&gt;</a> buckets;</div>
<div class="line">    <a class="code hl_class" href="classshm__object__pool.html">shm_object_pool&lt;Node&gt;</a> nodes;</div>
<div class="line">};</div>
<div class="ttc" id="aclassshm__object__pool_html"><div class="ttname"><a href="classshm__object__pool.html">shm_object_pool</a></div><div class="ttdoc">High-performance object pool for shared memory.</div><div class="ttdef"><b>Definition</b> <a href="shm__object__pool_8h_source.html#l00023">shm_object_pool.h:23</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md135"></a>
NUMA Awareness</h2>
<div class="fragment"><div class="line"><span class="comment">// Pin shared memory to NUMA node</span></div>
<div class="line"><span class="keywordtype">void</span>* addr = mmap(...);</div>
<div class="line">mbind(addr, size, MPOL_BIND, &amp;nodemask, ...);</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md136"></a>
Security Considerations</h1>
<h2><a class="anchor" id="autotoc_md137"></a>
1. Access Control</h2>
<div class="fragment"><div class="line"><span class="comment">// Set permissions on creation</span></div>
<div class="line"><span class="keywordtype">int</span> fd = shm_open(name, O_CREAT | O_RDWR, 0660);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md138"></a>
2. Input Validation</h2>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (index &gt;= capacity)</div>
<div class="line">    <span class="keywordflow">throw</span> std::out_of_range(<span class="stringliteral">&quot;...&quot;</span>);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md139"></a>
3. Resource Limits</h2>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keyword">constexpr</span> <span class="keywordtype">size_t</span> MAX_ALLOCATION = 1ULL &lt;&lt; 30;  <span class="comment">// 1GB</span></div>
<div class="line"><span class="keywordflow">if</span> (size &gt; MAX_ALLOCATION)</div>
<div class="line">    <span class="keywordflow">throw</span> std::invalid_argument(<span class="stringliteral">&quot;...&quot;</span>);</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md140"></a>
Future Directions</h1>
<h2><a class="anchor" id="autotoc_md141"></a>
1. Persistent Memory Support</h2>
<div class="fragment"><div class="line"><span class="comment">// Intel Optane DC support</span></div>
<div class="line"><span class="keyword">class </span>pmem_shm : <span class="keyword">public</span> <a class="code hl_class" href="classposix__shm__impl.html">posix_shm</a> {</div>
<div class="line">    <span class="keywordtype">void</span> persist() {</div>
<div class="line">        pmem_persist(base_addr, size);</div>
<div class="line">    }</div>
<div class="line">};</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md142"></a>
2. GPU Shared Memory</h2>
<div class="fragment"><div class="line"><span class="comment">// CUDA unified memory integration</span></div>
<div class="line"><span class="keyword">class </span>cuda_shm {</div>
<div class="line">    <span class="keywordtype">void</span>* allocate(<span class="keywordtype">size_t</span> size) {</div>
<div class="line">        cudaMallocManaged(&amp;ptr, size);</div>
<div class="line">    }</div>
<div class="line">};</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md143"></a>
3. Distributed Shared Memory</h2>
<div class="fragment"><div class="line"><span class="comment">// Network-transparent shared memory</span></div>
<div class="line"><span class="keyword">class </span>dsm_array : <span class="keyword">public</span> <a class="code hl_class" href="classshm__array.html">shm_array</a> {</div>
<div class="line">    <span class="keywordtype">void</span> <a class="code hl_typedef" href="classshm__array.html#a661ba8601539f45682ffac0bda0aa65d">sync</a>() {</div>
<div class="line">        <a class="code hl_typedef" href="classshm__array.html#a661ba8601539f45682ffac0bda0aa65d">rdma_write</a>(remote_addr, local_addr, size);</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="ttc" id="aclassshm__array_html_a661ba8601539f45682ffac0bda0aa65d"><div class="ttname"><a href="classshm__array.html#a661ba8601539f45682ffac0bda0aa65d">shm_array::reverse_iterator</a></div><div class="ttdeci">std::reverse_iterator&lt; iterator &gt; reverse_iterator</div><div class="ttdoc">Reverse iterator.</div><div class="ttdef"><b>Definition</b> <a href="shm__array_8h_source.html#l00278">shm_array.h:278</a></div></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md144"></a>
Design Principles Summary</h1>
<ol type="1">
<li><b>Zero-Overhead Abstraction</b>: Pay only for what you use</li>
<li><b>Lock-Free Where Possible</b>: Minimize contention</li>
<li><b>Cache-Conscious</b>: Optimize for memory hierarchy</li>
<li><b>Fail-Safe</b>: Graceful degradation over crashes</li>
<li><b>Discoverable</b>: Named structures for flexibility</li>
<li><b>Composable</b>: Build complex from simple</li>
<li><b>Type-Safe</b>: Compile-time constraints</li>
<li><b>RAII</b>: Automatic resource management </li>
</ol>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
